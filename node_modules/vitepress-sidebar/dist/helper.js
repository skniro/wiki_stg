import{readFileSync as e}from"fs";import t from"gray-matter";import{capitalizeFirst as r}from"./util.js";export function generateNotTogetherMessage(e){return`These options cannot be used together: ${e.join(", ")}`}export function getValueFromFrontmatter(r,n,o){try{const o=e(r,"utf-8"),{data:i}=t(o);if(i?.[n])return i[n];const a=o.split("\n");let l=!1;for(let e=0,t=a.length;e<t;e+=1){const t=a[e].toString().replace("\r","");if(/^---$/.test(t)&&(l=!0),new RegExp(`^${n}: (.*)`).test(t)&&l)return JSON.parse(t.replace(`${n}: `,""))}}catch(e){return o}return o}export function getOrderFromFrontmatter(e,t){return parseInt(getValueFromFrontmatter(e,"order",t.toString()),10)}export function getDateFromFrontmatter(e){return getValueFromFrontmatter(e,"date","0001-01-01")}export function getExcludeFromFrontmatter(e,t){return!!t&&getValueFromFrontmatter(e,t,!1)}export function formatTitle(e,t,n=!1){const o=[],i=[];let a=t;if(a=a.replace(/<[^>]*>/g,(e=>(o.push(e),""))),a=a.replace(/^(#+.*)$/gm,(e=>(i.push(e),""))),n&&!e.keepMarkdownSyntaxFromTitle&&(a=a.replace(/\*{1,2}([^*]+?)\*{1,2}/g,"$1"),a=a.replace(/_{1,2}([^_]+?)_{1,2}/g,"$1"),a=a.replace(/~{1,2}([^~]+?)~{1,2}/g,"$1"),a=a.replace(/`{1,3}([^`]+?)`{1,3}/g,"$1")),e.hyphenToSpace&&(a=a.replace(/-/g," ")),e.underscoreToSpace&&(a=a.replace(/_/g," ")),e.capitalizeEachWords){let e="";for(let t=0;t<a.length;t+=1)0!==t&&/[a-zA-Z0-9]/.test(e)||!/[a-z]/.test(a[t])||(a=a.slice(0,t)+a[t].toUpperCase()+a.slice(t+1)),e=a[t]}else e.capitalizeFirst&&(a=r(a));let l=-1,s=-1;return a=a.replace(new RegExp("","g"),(()=>(l+=1,i[l]))),a=a.replace(new RegExp("","g"),(()=>(s+=1,o[s]))),a}export function getTitleFromMd(t,r,n,o,i){if(o)return formatTitle(n,t);if(n.useTitleFromFrontmatter){let e=getValueFromFrontmatter(r,n.frontmatterTitleFieldName||"title",void 0);if(e||(e=getValueFromFrontmatter(r,"title",void 0)),e)return i?.(),formatTitle(n,e)}if(n.useTitleFromFileHeading)try{const t=e(r,"utf-8").split("\n");for(let e=0,r=t.length;e<r;e+=1){let r=t[e].toString().replace("\r","");if(/^# /.test(r)){if(r=r.replace(/^# /,""),/\[(.*)]\(.*\)/.test(r)){const e=/(.*)?\[(.*)]\((.*)\)(.*)?/.exec(r)||"";r=e.length>0?`${e[1]||""}${e[2]||""}${e[4]||""}`:""}return i?.(),formatTitle(n,r,!0)}}}catch{return"Unknown"}return formatTitle(n,t.replace(/\.md$/,""))}export function sortByFileTypes(e,t){for(let r=0;r<e.length;r+=1)e[r].items&&e[r].items.length&&(e[r].items=sortByFileTypes(e[r].items,t));const r=e.filter((e=>Object.hasOwn(e,"items"))),n=e.filter((e=>!Object.hasOwn(e,"items")));return"top"===t?[...r,...n]:[...n,...r]}export function sortByObjectKey(e){for(let t=0;t<e.arr.length;t+=1)e.arr[t].items&&e.arr[t].items.length&&(e.arr[t].items=sortByObjectKey({...e,arr:e.arr[t].items}));const t=new Intl.Collator([],{numeric:e.numerically,sensitivity:"base"});let r;if(e.dateSortFromFrontmatter)r=e.arr.sort(((t,r)=>new Date(t[e.key]).valueOf()-new Date(r[e.key]).valueOf())),e.desc&&(r=r.reverse());else if(e.dateSortFromTextWithPrefix){const t=/^[0-9]{4}-[0-9]{2}-[0-9]{2}/g;r=e.arr.sort(((r,n)=>{const o=r[e.key].split(t)?.[0],i=n[e.key].split(t)?.[0];return new Date(o).valueOf()-new Date(i).valueOf()})),e.desc&&(r=r.reverse())}else r=e.arr.sort(((r,n)=>{const o=t.compare(r[e.key],n[e.key]);return e.desc?-o:o}));return r}export function deepDeleteKey(e,t){"object"==typeof e&&null!==e&&(Object.hasOwn(e,t)&&delete e[t],Object.keys(e).forEach((r=>{"object"==typeof e[r]&&deepDeleteKey(e[r],t)})))}export function removePrefixFromTitleAndLink(e,t){const r=e.length;for(let n=0;n<r;n+=1){const r=e[n];for(let e=0;e<Object.keys(r).length;e+=1){const n=Object.keys(r)[e];if("text"===n){if(t.prefixSeparator instanceof RegExp||-1!==r[n].indexOf(t.prefixSeparator)){const e=r[n].split(t.prefixSeparator);e.shift(),r[n]=e.join(t.prefixSeparator)}}else"items"===n&&(r[n]=removePrefixFromTitleAndLink(r[n],t))}}return e}export function debugPrint(e,t){process.stdout.write(`\n${"=".repeat(50)}\n${JSON.stringify(e,null,2)}\n${"-".repeat(50)}\n${JSON.stringify(t,null,2)}\n${"=".repeat(50)}\n\n`)}